<polymer-element name="webrocket-google-drive-uploader" layout vertical center center-justified><template><style type="text/css">#dropArea{width:500px;height:300px;border:3px dashed #7b7b7b;border-radius:0;padding:0 10px;background-color:#fff;-webkit-transition:border-color 300ms ease 0ms,background-color 300ms ease 0ms;transition:border-color 300ms ease 0ms,background-color 300ms ease 0ms}#dropArea[dragging]{border-color:#4682b4;background-color:rgba(70,130,180,.12)}#dropArea[dragging]>core-item.help{color:#4682b4}#dropArea[dragging]>core-item.help.or{opacity:0}#dropArea>input{font-family:"Open Sans",sans-serif;font-size:15px;border-radius:5px;padding:10px}#dropArea>input,#dropArea>paper-button{color:#4682b4;border:1px solid #4682b4;-webkit-transition:opacity 300ms ease 0ms;transition:opacity 300ms ease 0ms}#dropArea[dragging]>input,#dropArea[dragging]>paper-button{pointer-events:none;color:grey;border:1px solid grey;opacity:0}#dropArea>core-item.help{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-family:"Open Sans",sans-serif;font-size:24px;font-weight:700;color:#000;-webkit-transition:color 300ms ease 0ms;transition:color 300ms ease 0ms}#dropArea>core-item.help.or{font-size:20px;color:#8b8b8b;-webkit-transition:opacity 300ms ease 0ms;transition:opacity 300ms ease 0ms}@media (max-width:650px){#dropArea{width:350px}}@media (max-width:480px){#dropArea{width:initial}}@media (max-height:480px){#dropArea{height:200px}}@media (max-height:380px){#dropArea{height:100px}#dropArea>core-item.help{font-size:20px}#dropArea>core-item.help.or{display:none}}#padding,#sharing{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#sharing{font-size:17px;height:50px;white-space:pre}</style><div id="dropArea" layout vertical center center-justified dragging?="{{dragging}}"><core-item id="padding" flex></core-item><core-item class="help" hidden?="{{mobile}}">{{!dragging ? "Drag a file here" : "Drop to upload" }}</core-item><core-item class="help or" hidden?="{{mobile}}">OR</core-item><input id="filePicker" type="file"><core-item id="padding" flex></core-item><core-item id="sharing"><b>Sharing as</b> {{ publiclyWritable || publiclyReadable ? ('anyone ' + (withLink ? 'with a link ' : '') + (publiclyWritable ? 'can edit' : 'can view')) : 'private' }}</core-item></div></template><script>!function(){"use strict";Polymer({publish:{parentFolderId:"",publiclyWritable:!1,publiclyReadable:!1,withLink:!0,mobile:!1,dragging:!1},cachedUploadResponse:void 0,cachedPermissionResponse:void 0,created:function(){},ready:function(){this.mobile="object"==typeof Tundra&&Tundra.browser.isMobile(),this.$.dropArea.addEventListener("dragenter",function(e){this.dragging=!0}.bind(this)),this.$.dropArea.addEventListener("dragleave",function(e){this.dragging=!1}.bind(this)),this.$.dropArea.addEventListener("dragover",function(e){e.preventDefault&&e.preventDefault(),e.dataTransfer.effectAllowed&&(e.dataTransfer.dropEffect="move")}.bind(this)),this.$.dropArea.addEventListener("drop",function(e){this.dragging=!1,e.preventDefault&&e.preventDefault(),e.dataTransfer.files.length>0&&this.upload(e.dataTransfer.files.item(0))}.bind(this)),this.$.filePicker.addEventListener("change",function(e){this.$.filePicker.files.length>0&&this.upload(this.$.filePicker.files.item(0))}.bind(this),!1)},upload:function(e){var i="-------314159265358979323846",t="\r\n--"+i+"\r\n",r="\r\n--"+i+"--",n=new FileReader;n.readAsBinaryString(e),n.onload=function(a){var d=e.type||"application/octet-stream",o={title:e.name,mimeType:d};"string"==typeof this.parentFolderId&&""!==this.parentFolderId&&(o.parents=[{id:this.parentFolderId}]);var s=btoa(n.result),l=t+"Content-Type: application/json\r\n\r\n"+JSON.stringify(o)+t+"Content-Type: "+d+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+s+r,p=gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+i+'"'},body:l});p.execute(this.uploadCompleted.bind(this)),this.fire("upload-start")}.bind(this),n.onabort=function(){this.fire("upload-cancel")},n.onerror=function(){this.fire("upload-error")}.bind(this)},uploadCompleted:function(e){return e.error?void this.fire("upload-error",e.error):e.id?(this.cachedUploadResponse=e,void this.updatePermissions(this.publiclyWritable,this.publiclyReadable,this.withLink)):void this.fire("upload-error","Google Drive response is missing file id")},updatePermissions:function(e,i,t){return e||i?void Tundra.plugins.googleDrive.updatePublicPermissions(this.cachedUploadResponse.id,e,i,t).always(function(){this.fire("upload-completed",this.cachedUploadResponse)}.bind(this)):void this.fire("upload-completed",this.cachedUploadResponse)}})}();</script></polymer-element>