<polymer-element name="webrocket-stats" attributes="data"><template><style type="text/css">:host{pointer-events:none}#container{pointer-events:auto;background-color:rgba(255,255,255,.8);padding:8px;padding-left:20px;padding-right:10px}core-tooltip[large]::shadow .core-tooltip{font-size:15px;padding:12px;left:0;margin-left:calc(100% + 5px);pointer-events:none}core-tooltip::shadow .core-tooltip{opacity:0!important;-webkit-transition:all 0ms ease 0ms;transition:all 0ms ease 0ms;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}core-tooltip:focus::shadow .core-tooltip,core-tooltip:hover::shadow .core-tooltip{opacity:1!important;-webkit-transition:all 400ms ease 300ms;transition:all 400ms ease 300ms;-webkit-transform:translate3d(5px,0,0);transform:translate3d(5px,0,0)}core-tooltip:focus{visibility:hidden!important}.stat,.stat-container,.sub-stat,.title{height:24px;min-height:1px}.stat-container{min-width:220px}.stat-container[wrapped]{min-width:70px;margin-left:15px}.stat-container[wrapped]>.sub-stat{margin:0;margin-right:7px}.stat-container[wrapped]>.stat{margin-left:0}.title{font-weight:600;text-transform:uppercase;font-size:14px}.stat{font-size:18px;margin-left:30px;color:#000}.stat[green]{color:#186b18}.stat[red]{color:#b82121}.sub-stat{color:grey;font-size:15px}.sub-stat[right]{margin-left:7px;padding-top:8px}.sub-stat[left]{margin-right:7px;padding-top:8px}.indent{margin-left:15px}core-item[section]{cursor:pointer}core-item[section]:hover{color:#000}core-icon-button{margin:0 0;padding:0 5px}paper-button{margin:0;border-radius:0;background-color:#fff}paper-button::shadow>.button-content{padding:.3em .1em}#debug{background:#9e9e9e;color:#eae9e9}#debug[debugging]{background:#186b18;color:#fff}#resolution[low]{background:#FFEB3B}@media (max-height:800px),(max-width:1000px){#container{padding-left:10px}.title{font-size:12px}.stat-container{height:22px;min-width:150px}.stat-container[wrapped]{height:20px;min-width:55px;margin-left:15px}.stat{font-size:14px}.sub-stat{font-size:14px}paper-button{padding:1px 4px;font-size:13px}}paper-fab#close{width:28px;height:28px;padding:4px;background:#F5F5F5;color:#8C8C8C;position:absolute;top:-9px;left:-16px;z-index:1}paper-fab#close:hover{background:#b82121;color:#fff}paper-fab::shadow>core-icon{width:20px;height:20px}</style><paper-shadow z="1" animated id="container"><div layout vertical start center-justified><paper-fab id="close" mini icon="close" on-click="{{ onClose }}"></paper-fab><paper-button id="resolution" self-stretch raised on-click="{{ onToggleResolution }}" low?="{{ !highResolution}}" style="margin-bottom:5px">{{ highResolution ? 'High' : 'Low' }} Resolution</paper-button><div layout horizontal class="stat-container"><core-item class="title">FPS</core-item><core-item class="stat" flex end-justified green?="{{ data.fps > 30.0 }}" red?="{{ data.fps < 29.9 }}">{{ data.fps | toFixed }}</core-item></div><div layout horizontal center-justified class="stat-container"><core-item class="title" flex section="renderer" on-click="{{ onToggleSection }}">Rendering</core-item><core-icon-button icon="{{ data.hidden.renderer ? 'expand-more' : 'expand-less' }}" section="renderer" on-click="{{ onToggleSection }}"></core-icon-button></div><div layout vertical hidden?="{{ data.hidden.renderer }}"><div layout horizontal class="stat-container"><core-item class="sub-stat indent">draw calls</core-item><core-item class="stat" flex end-justified red?="{{ data.renderer.three.render.calls > 1000 }}">{{ data.renderer.three.render.calls }}</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">vertices</core-item><core-item class="stat" flex end-justified>{{ data.renderer.three.render.vertices | toFixedInt }}</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">faces</core-item><core-item class="stat" flex end-justified>{{ data.renderer.three.render.faces | toFixedInt }}</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">points</core-item><core-item class="stat" flex end-justified>{{ data.renderer.three.render.points | toFixedInt }}</core-item></div></div><div layout horizontal class="stat-container"><core-item class="title" flex section="assets" on-click="{{ onToggleSection }}">assets</core-item><core-icon-button icon="{{ data.hidden.assets ? 'expand-more' : 'expand-less' }}" section="assets" on-click="{{ onToggleSection }}"></core-icon-button></div><div layout vertical hidden?="{{ data.hidden.assets }}"><template repeat="{{ level in data.assets.loaded }}"><div layout horizontal class="stat-container"><core-item class="sub-stat indent">{{ level.key }}</core-item><core-item class="stat" flex end-justified>{{ level.value }}</core-item></div></template><div layout vertical hidden?="{{ data.assets.active.length == 0 }}" extra><div layout horizontal class="stat-container"><core-item class="title">active transfers</core-item></div><div layout horizontal center class="stat-container" wrap style="width:240px;height:auto;margin-bottom:5px"><template repeat="{{ level in data.assets.active }}"><div layout horizontal class="stat-container" wrapped><core-item class="sub-stat indent">{{ level.key }}</core-item><core-item class="stat" flex end-justified>{{ level.value }}</core-item></div></template></div></div><div layout vertical hidden?="{{ data.assets.queued.length == 0 }}" extra><div layout horizontal class="stat-container"><core-item class="title">queued transfers</core-item></div><div layout horizontal center class="stat-container" wrap style="width:240px;height:auto;margin-bottom:5px"><template repeat="{{ level in data.assets.queued }}"><div layout horizontal class="stat-container" wrapped><core-item class="sub-stat indent">{{ level.key }}</core-item><core-item class="stat" flex end-justified>{{ level.value }}</core-item></div></template></div></div></div><div layout horizontal class="stat-container" extra><core-item class="title" flex section="scene" on-click="{{ onToggleSection }}">Scene</core-item><core-icon-button icon="{{ data.hidden.scene ? 'expand-more' : 'expand-less' }}" section="scene" on-click="{{ onToggleSection }}"></core-icon-button></div><div layout vertical hidden?="{{ data.hidden.scene }}"><div layout horizontal class="stat-container" extra><core-item class="sub-stat indent">Entities</core-item><core-item class="stat" flex end-justified>{{ data.scene.entities.length }}</core-item></div><template repeat="{{ comp in data.scene.components }}"><div layout horizontal class="stat-container" hidden?="{{ comp.value == 0 }}" extra><core-item class="sub-stat indent">{{ comp.key }}</core-item><core-item class="stat" flex end-justified>{{ comp.value }}</core-item></div></template></div></div></paper-shadow></template><script>!function(){"use strict";Polymer({publish:{highResolution:!0},created:function(){this.highResolution=1===Tundra.renderer.devicePixelRatio(),this.subs=[],this.data={hidden:{renderer:!1,assets:!0,scene:!0}},this.delayed={},this.limiter=new Tundra.Classes.FrameLimiter(Tundra.browser.isMobile()?1:.25),this.timing=new Tundra.Classes.AsyncHelper("webrocket-stats",this)},ready:function(){},attached:function(){this.subs.push(Tundra.frame.onUpdate(this.onUpdate.bind(this))),this.subs.push(Tundra.asset.onActiveAssetTransferCountChanged(this.onAssetsChanged.bind(this))),this.subs.push(Tundra.scene.onEntityCreated(this.onSceneChanged.bind(this))),this.subs.push(Tundra.scene.onEntityRemoved(this.onSceneChanged.bind(this))),this.subs.push(Tundra.scene.onComponentCreated(this.onSceneChanged.bind(this))),this.subs.push(Tundra.scene.onComponentRemoved(this.onSceneChanged.bind(this))),this.onUpdate(1),this.onAssetsChanged(),this.onSceneChanged(),this.data.renderer={three:Tundra.renderer.renderer.info}},detached:function(){for(var e=0;e<this.subs.length;e++)this.subs[e].reset();this.subs=[]},onClose:function(){Tundra.ui.toggleStatsWidget()},onToggleResolution:function(){this.highResolution=!this.highResolution,Tundra.renderer.setDevicePixelRatio(this.highResolution?1:.5)},onToggleSection:function(e,t,n){var s=n.getAttribute("section"),i="string"==typeof s&&""!==s?s:n.id;if(this.data.hidden[i]="boolean"==typeof this.data.hidden[i]?!this.data.hidden[i]:!0,!this.data.hidden[i])switch(i){case"assets":this.onAssetsChanged();break;case"scene":this.onSceneChanged()}},keys:function(e){return"object"==typeof e?Object.keys(e):[]},numKeys:function(e){return"object"==typeof e?Object.keys(e).length>0:!1},toFixedInt:function(e){if("number"==typeof e){var t=this.toFixed(e),n=t.indexOf(",");return-1!==n&&(t=t.substring(0,n)),t}return e},toFixed:function(e){if("number"==typeof e){var t=Tundra.Classes.CoreStringUtils.formatNumber(Math.round(100*e)/100);return-1===t.indexOf(",")?t+=",00":t.length-t.lastIndexOf(",")<=2&&(t+="0"),t}return e},onUpdate:function(e){this.limiter.shouldUpdate(e)&&(this.hidden||(this.data.fps=Tundra.frame.stats.fps,60-this.data.fps<=.5&&(this.data.fps=60)))},onAssetsChanged:function(){if(!this.data.hidden.assets){for(var e={loaded:[],active:[],loading:[],queued:[]},t=Tundra.asset.cache.assetData(),n=Object.keys(t),s=0;s<n.length;s++){var i=t[n[s]];e.loaded.push({key:n[s],value:i})}var a=Tundra.asset.transferState();n=Object.keys(a.active);for(var s=0;s<n.length;s++){var i=a.active[n[s]];e.active.push({key:n[s],value:i})}n=Object.keys(a.loading);for(var s=0;s<n.length;s++){var i=a.loading[n[s]];e.loading.push({key:n[s],value:i})}n=Object.keys(a.queued);for(var s=0;s<n.length;s++){var i=a.queued[n[s]];e.queued.push({key:n[s],value:i})}this.data.assets=e}},onSceneChanged:function(){this.data.hidden.scene||(this.data.scene={entities:Tundra.scene.entities,components:[{key:"Placeable",value:Tundra.scene.entitiesWithComponent("Placeable").length},{key:"Mesh",value:Tundra.scene.entitiesWithComponent("Mesh").length},{key:"Script",value:Tundra.scene.entitiesWithComponent("Script").length}]})},updateDelayedTypes:function(e,t,n){0===e.length?this.updateDelayed(t,n):this.delayed[t]=0},updateDelayed:function(e,t){void 0===this.delayed[e]?this.delayed[e]=0:this.delayed[e]+=t}})}();</script></polymer-element>