<polymer-element name="meshmoon-geo-stats" attributes="data"><template><style type="text/css">:host{pointer-events:none}#container{pointer-events:auto;background-color:rgba(255,255,255,.8);padding:8px;padding-left:20px;padding-right:10px}core-tooltip[large]::shadow .core-tooltip{font-size:15px;padding:12px;left:0;margin-left:calc(100% + 5px);pointer-events:none}core-tooltip::shadow .core-tooltip{opacity:0!important;-webkit-transition:all 0ms ease 0ms;transition:all 0ms ease 0ms;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}core-tooltip:focus::shadow .core-tooltip,core-tooltip:hover::shadow .core-tooltip{opacity:1!important;-webkit-transition:all 400ms ease 300ms;transition:all 400ms ease 300ms;-webkit-transform:translate3d(5px,0,0);transform:translate3d(5px,0,0)}core-tooltip:focus{visibility:hidden!important}.stat,.stat-container,.sub-stat,.title{height:24px;min-height:1px}.stat-container{min-width:220px}.stat-container[wrap]{max-width:220px}.stat-container[wrapped]{min-width:70px;margin-left:15px}.stat-container[wrapped]>.sub-stat{margin:0;margin-right:7px}.stat-container[wrapped]>.stat{margin-left:0}.title{font-weight:600;text-transform:uppercase;font-size:14px}.stat{font-size:18px;margin-left:30px;color:#000}.stat[green]{color:#186b18}.stat[red]{color:#b82121}.sub-stat{color:grey;font-size:15px}.sub-stat[right]{margin-left:7px;padding-top:8px}.sub-stat[left]{margin-right:7px;padding-top:8px}.indent{margin-left:15px}core-item[section]{cursor:pointer}core-item[section]:hover{color:#000}core-icon-button{margin:0 0;padding:0 5px}paper-button{margin:0;border-radius:0;background-color:#fff}paper-button::shadow>.button-content{padding:.3em .1em}.debug-button{background:#9e9e9e;color:#eae9e9}.debug-button[debugging]{background:#186b18;color:#fff}#resolution[low]{background:#FFEB3B}paper-fab#close{width:28px;height:28px;padding:4px;background:#F5F5F5;color:#8C8C8C;position:absolute;top:-9px;left:-16px;z-index:1}paper-fab#close:hover{background:#b82121;color:#fff}paper-fab::shadow>core-icon{width:20px;height:20px}@media (max-height:800px),(max-width:1000px){#container{padding-left:10px}.title{font-size:12px}.stat-container{height:22px;min-width:150px}.stat-container[wrap]{max-width:150px}.stat-container[wrapped]{height:20px;min-width:55px;margin-left:15px}.stat{font-size:14px}.sub-stat{font-size:14px}paper-button{padding:1px 4px;font-size:13px}}</style><paper-shadow z="1" animated id="container"><div layout vertical start center-justified><paper-fab id="close" mini icon="close" on-click="{{ onClose }}"></paper-fab><paper-button class="debug-button" self-stretch raised on-click="{{ onToggleDebug }}" debugging?="{{ plugin.config.grid.debug }}">{{ plugin.config.grid.debug ? 'Debugging tiles' : 'Debug tiles OFF' }}</paper-button><paper-button class="debug-button" self-stretch raised on-click="{{ onToggleDebugAssets }}" debugging?="{{ plugin.config.grid.debugAssets }}">{{ plugin.config.grid.debugAssets ? 'debugging assets' : 'debug assets OFF' }}</paper-button><paper-button id="resolution" self-stretch raised on-click="{{ onToggleResolution }}" low?="{{ !highResolution}}">{{ highResolution ? 'High' : 'Low' }} Resolution</paper-button><div style="height:7px"></div><div layout horizontal class="stat-container"><core-item class="title">FPS</core-item><core-item class="stat" flex end-justified green?="{{ data.fps > 30.0 }}" red?="{{ data.fps < 29.9 }}">{{ data.fps | toFixed }}</core-item></div><div layout horizontal class="stat-container"><core-item class="title">Tiles</core-item><core-item class="stat" flex end-justified>{{ data.tiles.visible.length }}<div class="sub-stat" right>/ {{ data.tiles.num }}</div></core-item></div><div layout horizontal class="stat-container"><core-item class="title">Active tile</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">zoom</core-item><core-item class="stat" flex end-justified>{{ data.tiles.focused.zoomLevel.zoom }}<div class="sub-stat" right>x</div></core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">size</core-item><core-item class="stat" flex end-justified>{{ data.tiles.focused.tileSize.x | toFixedDistance }}<div class="sub-stat" right>{{ data.tiles.focused.tileSize.x | distanceUnit }}</div></core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">to camera</core-item><core-item class="stat" flex end-justified>{{ data.tiles.focused.distanceToCamera | toFixedDistance }}<div class="sub-stat" right>{{ data.tiles.focused.distanceToCamera | distanceUnit }}</div></core-item></div><div layout horizontal class="stat-container"><core-item class="title" flex section="assets" on-click="{{ onToggleSection }}">Assets</core-item><core-icon-button icon="{{ data.hidden.assets ? 'expand-more' : 'expand-less' }}" section="assets" on-click="{{ onToggleSection }}"></core-icon-button></div><div layout vertical hidden?="{{ data.hidden.assets }}"><div layout horizontal class="stat-container" hidden?="{{ data.assets.textures == 0 }}"><core-item class="sub-stat indent">textures</core-item><core-item class="stat" flex end-justified>{{ data.assets.textures }}</core-item></div><div layout horizontal class="stat-container" hidden?="{{ data.assets.buildings == 0 }}"><core-item class="sub-stat indent">buildings</core-item><core-item class="stat" flex end-justified>{{ data.assets.buildings }}</core-item></div><div layout horizontal class="stat-container" hidden?="{{ data.assets.terrains == 0 }}"><core-item class="sub-stat indent">terrain</core-item><core-item class="stat" flex end-justified>{{ data.assets.terrains }}</core-item></div><div layout horizontal class="stat-container" hidden?="{{ data.assets.vegetations == 0 }}"><core-item class="sub-stat indent">vegeration</core-item><core-item class="stat" flex end-justified>{{ data.assets.vegetations }}</core-item></div><template if="{{ data.assets.pending | numKeys }}"><div layout horizontal class="stat-container"><core-item class="title">Loading</core-item></div><template repeat="{{ type in data.assets.pending | keys }}"><div layout horizontal class="stat-container"><core-item class="sub-stat indent">{{ type }}</core-item><core-item class="stat" flex end-justified>{{ type | numPending }}</core-item></div></template></template></div><div layout horizontal class="stat-container"><core-item class="title" flex section="chainer" on-click="{{ onToggleSection }}">Chainer</core-item><core-icon-button icon="{{ data.hidden.chainer ? 'expand-more' : 'expand-less' }}" section="chainer" on-click="{{ onToggleSection }}"></core-icon-button></div><div layout vertical hidden?="{{ data.hidden.chainer }}"><div layout horizontal class="stat-container"><core-item class="sub-stat indent">executed</core-item><core-item class="stat" flex end-justified>{{ data.chainer.Executes }}</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">loaded</core-item><core-item class="stat" flex end-justified>{{ data.chainer.Loaded }}</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">suppressed</core-item><core-item class="stat" flex end-justified>{{ data.chainer.Suppressed }}</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">exec</core-item><core-item class="stat" flex end-justified>{{ data.chainer.ExecSpent | durationMsec }}</core-item></div><div layout horizontal class="stat-container"><core-item class="sub-stat indent">load</core-item><core-item class="stat" flex end-justified>{{ data.chainer.LoadSpent | durationMsec }}</core-item></div></div><div layout horizontal class="stat-container"><core-item class="title" flex section="quadtree" on-click="{{ onToggleSection }}">Quad Tree</core-item><core-icon-button icon="{{ data.hidden.quadtree ? 'expand-more' : 'expand-less' }}" section="quadtree" on-click="{{ onToggleSection }}"></core-icon-button></div><div layout horizontal center class="stat-container" wrap style="height:auto;margin-bottom:5px" hidden?="{{ data.hidden.quadtree }}"><template repeat="{{ level in data.quadtree.visible }}"><div layout horizontal class="stat-container" wrapped><core-item class="sub-stat indent">{{ level.zoom }}x</core-item><core-item class="stat" flex end-justified>{{ level.num }}</core-item></div></template></div></div></paper-shadow></template><script>!function(){"use strict";Polymer({publish:{highResolution:!0},created:function(){this.highResolution=1===Tundra.renderer.devicePixelRatio(),this.subs=[],this.data={hidden:{assets:!0,quadtree:!0,chainer:!0}},this.plugin=Tundra.plugins.meshmoonGeo,this.limiter=new Tundra.Classes.FrameLimiter(Tundra.browser.isMobile()?1:.25),this.timing=new Tundra.Classes.AsyncHelper("meshmoon-geo-stats",this)},ready:function(){},attached:function(){this.subs.push(Tundra.frame.onUpdate(this.onUpdate.bind(this))),this.subs.push(this.plugin.grid.onGridChanged(this.onGridChanged.bind(this))),this.onGridChanged()},detached:function(){for(var i=0;i<this.subs.length;i++)this.subs[i]&&this.subs[i].reset();this.subs=[]},onClose:function(){this.plugin.toggleStatsWidget()},onToggleResolution:function(){this.highResolution=!this.highResolution,Tundra.renderer.setDevicePixelRatio(this.highResolution?1:.5)},onToggleSection:function(i,t,e){var s=e.getAttribute("section"),n="string"==typeof s&&""!==s?s:e.id;this.data.hidden[n]="boolean"==typeof this.data.hidden[n]?!this.data.hidden[n]:!0},onToggleDebug:function(){this.plugin.toggleDebugging()},onToggleDebugAssets:function(){this.plugin.toggleDebuggingAssets()},numQuadVisible:function(i){return this.data&&this.data.quadtree&&this.data.quadtree.visible?this.data.quadtree.visible[i]:0},numPending:function(i){return this.data&&this.data.assets&&this.data.assets.pending?this.data.assets.pending[i]:0},keys:function(i){return"object"==typeof i?Object.keys(i):[]},numKeys:function(i){return"object"==typeof i?Object.keys(i).length>0:!1},toFixed:function(i){if("number"==typeof i){var t=Tundra.Classes.CoreStringUtils.formatNumber(Math.round(100*i)/100);return-1===t.indexOf(",")?t+=",00":t.length-t.lastIndexOf(",")<=2&&(t+="0"),t}return i},toFixedDistance:function(i){return"number"==typeof i?this.toFixed(i>=1e3?i/1e3:i):i},distanceUnit:function(i){return"number"==typeof i&&i>=1e3?"km":"m"},durationMsec:function(i){return"number"==typeof i?i>=1e3?(i/1e3).toFixed(2)+" sec":i.toFixed(2)+" ms":i},onUpdate:function(i){if(this.limiter.shouldUpdate(i)&&!this.hidden){this.data.fps=Tundra.frame.stats.fps,60-this.data.fps<=.5&&(this.data.fps=60);var t=this.plugin.grid.tiles();this.data.tiles={tiles:t,visible:this.plugin.grid.visibleTiles(),num:t.length,focused:this.plugin.grid.focusedTile};var e={textures:0,buildings:0,terrains:0,vegetations:0,pending:this.plugin.tracker.pendingData()};this.data.chainer=this.plugin.chainer.$class.Stats;for(var s=0;s<this.data.tiles.tiles.length;s++){var n=this.data.tiles.tiles[s];n&&(e.textures+=n.numLoadedTextures(),e.buildings+=n.isBuildingsMeshVisible()?1:0,e.terrains+=n.isTerrainMeshVisible()?1:0,e.vegetations+=n.isVegetationMeshVisible()?1:0)}this.data.assets=e}},onGridChanged:function(){this.onUpdate(1);for(var i={visible:{}},t=0;t<this.data.tiles.tiles.length;t++){var e=this.data.tiles.tiles[t];e&&e.visible&&(void 0===i.visible[e.zoomLevel.zoom]?i.visible[e.zoomLevel.zoom]=1:i.visible[e.zoomLevel.zoom]++)}var s=[];for(var n in i.visible)s.unshift({zoom:n,num:i.visible[n]});this.data.quadtree={visible:s}}})}();</script></polymer-element>